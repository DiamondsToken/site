"use strict";var Ke=Object.defineProperty;var ke=(e,t,r)=>t in e?Ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var b=(e,t,r)=>ke(e,typeof t!="symbol"?t+"":t,r);const J=require("web3-utils"),U=require("@solana/web3.js");class ye{constructor(){b(this,"subscriptions",{})}on(t){const{event:r,handler:n}=t;this.subscriptions[r]||(this.subscriptions[r]=[]),this.subscriptions[r].push(n)}off(t){const{event:r,handler:n}=t;this.subscriptions[r]&&(this.subscriptions[r]=this.subscriptions[r].filter(s=>s!==n))}emit(t,r){this.subscriptions[t]&&this.subscriptions[t].forEach(n=>n(r))}}const be="okxWidget";function y(e,t,r){const s={key:be,method:t,...typeof r=="object"?r:{}};e==null||e.postMessage(s,"*")}function V(e,t,r){const n=s=>{!Ye(s.data)||s.data.key!==be||s.data.method!==t||r(s.data)};return e.addEventListener("message",n),n}function Ye(e){return typeof e=="object"&&e!==null&&"key"in e&&"method"in e&&typeof e.key=="string"&&typeof e.method=="string"}function te(e,t,r){e.removeEventListener("message",r)}function ie(e,t){e.removeEventListener("message",t)}var x=(e=>(e.ACTIVATE="ACTIVATE",e.UPDATE_HEIGHT="UPDATE_HEIGHT",e.SET_FULL_HEIGHT="SET_FULL_HEIGHT",e.EMIT_OKX_EVENT="EMIT_OKX_EVENT",e.PROVIDER_RPC_REQUEST="PROVIDER_RPC_REQUEST",e.INTERCEPT_WINDOW_OPEN="INTERCEPT_WINDOW_OPEN",e.LOAD_READY="LOAD_READY",e))(x||{}),I=(e=>(e.UPDATE_PARAMS="UPDATE_PARAMS",e.UPDATE_APP_DATA="UPDATE_APP_DATA",e.PROVIDER_RPC_RESPONSE="PROVIDER_RPC_RESPONSE",e.PROVIDER_ON_EVENT="PROVIDER_ON_EVENT",e.PROVIDER_ON_EVENT_CONNECT="PROVIDER_ON_EVENT_CONNECT",e.PROVIDER_ONEVENT_WALLET_SATUS="PROVIDER_ONEVENT_WALLET_SATUS",e.PROVIDER_ONEVENT_WALLET_SOLANA_SATUS="PROVIDER_ONEVENT_WALLET_SOLANA_SATUS",e.UPDATE_PROVIDER="UPDATE_PROVIDER",e))(I||{}),v=(e=>(e.PROVIDER_ON_EVENT_CONNECT="PROVIDER_ON_EVENT_CONNECT",e.PROVIDER_ON_EVENT="PROVIDER_ON_EVENT",e.PROVIDER_ONEVENT_WALLET_SATUS="PROVIDER_ONEVENT_WALLET_SATUS",e.NO_WALLET_CONNECT="NO_WALLET_CONNECT",e))(v||{}),C=(e=>(e.SWAP="swap",e.BRIDGE="bridge",e.AUTO="auto",e))(C||{}),Pe=(e=>(e.LIGHT="light",e.DARK="dark",e))(Pe||{});const Xe=["primary","background","paper","text","danger","warning","alert","info","success"];var N=(e=>(e.EVM="EVM",e.SOLANA="SOLANA",e.WALLET_CONNECT="WALLET_CONNECT",e))(N||{});const Je=N;class Qe{constructor(t,r=[]){b(this,"eventEmitter",new ye);b(this,"listeners",[]);b(this,"widgetListener");this.contentWindow=t,this.updateListeners(r),this.widgetListener=V(this.contentWindow,x.EMIT_OKX_EVENT,n=>{const s=n.payload||(n==null?void 0:n.params);console.log("eventEmitter:",{okxEvent:n,event:n.event,payload:s}),this.eventEmitter.emit(n.event,s)})}stopListeningIframe(){ie(this.contentWindow,this.widgetListener)}updateListeners(t){for(const r of this.listeners)this.eventEmitter.off(r);this.listeners=t||[];for(const r of this.listeners)this.eventEmitter.on(r)}}var Re=typeof global=="object"&&global&&global.Object===Object&&global,Ze=typeof self=="object"&&self&&self.Object===Object&&self,Se=Re||Ze||Function("return this")(),z=Se.Symbol,Ce=Object.prototype,et=Ce.hasOwnProperty,tt=Ce.toString,j=z?z.toStringTag:void 0;function rt(e){var t=et.call(e,j),r=e[j];try{e[j]=void 0;var n=!0}catch{}var s=tt.call(e);return n&&(t?e[j]=r:delete e[j]),s}var nt=Object.prototype,ot=nt.toString;function st(e){return ot.call(e)}var at="[object Null]",it="[object Undefined]",de=z?z.toStringTag:void 0;function Y(e){return e==null?e===void 0?it:at:de&&de in Object(e)?rt(e):st(e)}function X(e){return e!=null&&typeof e=="object"}var ce=Array.isArray;function De(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ct(e){return e}var ut="[object AsyncFunction]",lt="[object Function]",Et="[object GeneratorFunction]",ft="[object Proxy]";function dt(e){if(!De(e))return!1;var t=Y(e);return t==lt||t==Et||t==ut||t==ft}function Tt(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}var ht=9007199254740991,gt=/^(?:0|[1-9]\d*)$/;function mt(e,t){var r=typeof e;return t=t??ht,!!t&&(r=="number"||r!="symbol"&&gt.test(e))&&e>-1&&e%1==0&&e<t}var _t=9007199254740991;function Le(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=_t}function Ve(e){return e!=null&&Le(e.length)&&!dt(e)}var pt=Object.prototype;function Ot(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||pt;return e===r}function At(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var Nt="[object Arguments]";function Te(e){return X(e)&&Y(e)==Nt}var ve=Object.prototype,It=ve.hasOwnProperty,wt=ve.propertyIsEnumerable,yt=Te(function(){return arguments}())?Te:function(e){return X(e)&&It.call(e,"callee")&&!wt.call(e,"callee")};function bt(){return!1}var xe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,he=xe&&typeof module=="object"&&module&&!module.nodeType&&module,Pt=he&&he.exports===xe,ge=Pt?Se.Buffer:void 0,Rt=ge?ge.isBuffer:void 0,St=Rt||bt,Ct="[object Arguments]",Dt="[object Array]",Lt="[object Boolean]",Vt="[object Date]",vt="[object Error]",xt="[object Function]",Wt="[object Map]",jt="[object Number]",Ft="[object Object]",Ut="[object RegExp]",$t="[object Set]",Gt="[object String]",Mt="[object WeakMap]",Bt="[object ArrayBuffer]",qt="[object DataView]",Ht="[object Float32Array]",zt="[object Float64Array]",Kt="[object Int8Array]",kt="[object Int16Array]",Yt="[object Int32Array]",Xt="[object Uint8Array]",Jt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",Zt="[object Uint32Array]",T={};T[Ht]=T[zt]=T[Kt]=T[kt]=T[Yt]=T[Xt]=T[Jt]=T[Qt]=T[Zt]=!0;T[Ct]=T[Dt]=T[Bt]=T[Lt]=T[qt]=T[Vt]=T[vt]=T[xt]=T[Wt]=T[jt]=T[Ft]=T[Ut]=T[$t]=T[Gt]=T[Mt]=!1;function er(e){return X(e)&&Le(e.length)&&!!T[Y(e)]}function tr(e){return function(t){return e(t)}}var We=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$=We&&typeof module=="object"&&module&&!module.nodeType&&module,rr=$&&$.exports===We,Q=rr&&Re.process,me=function(){try{var e=$&&$.require&&$.require("util").types;return e||Q&&Q.binding&&Q.binding("util")}catch{}}(),_e=me&&me.isTypedArray,nr=_e?tr(_e):er,or=Object.prototype,sr=or.hasOwnProperty;function ar(e,t){var r=ce(e),n=!r&&yt(e),s=!r&&!n&&St(e),o=!r&&!n&&!s&&nr(e),a=r||n||s||o,d=a?At(e.length,String):[],l=d.length;for(var u in e)sr.call(e,u)&&!(a&&(u=="length"||s&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||mt(u,l)))&&d.push(u);return d}function ir(e,t){return function(r){return e(t(r))}}var cr=ir(Object.keys,Object),ur=Object.prototype,lr=ur.hasOwnProperty;function Er(e){if(!Ot(e))return cr(e);var t=[];for(var r in Object(e))lr.call(e,r)&&r!="constructor"&&t.push(r);return t}function fr(e){return Ve(e)?ar(e):Er(e)}function dr(e){return function(t,r,n){for(var s=-1,o=Object(t),a=n(t),d=a.length;d--;){var l=a[++s];if(r(o[l],l,o)===!1)break}return t}}var Tr=dr();function hr(e,t){return e&&Tr(e,t,fr)}function gr(e,t){return function(r,n){if(r==null)return r;if(!Ve(r))return e(r,n);for(var s=r.length,o=-1,a=Object(r);++o<s&&n(a[o],o,a)!==!1;);return r}}var mr=gr(hr);function _r(e){return typeof e=="function"?e:ct}function pr(e,t){var r=ce(e)?Tt:mr;return r(e,_r(t))}var Or="[object String]";function Ar(e){return typeof e=="string"||!ce(e)&&X(e)&&Y(e)==Or}var pe={WIDGET_VERSION:"1",SDK_VERSION:"1.3.11"};const Nr="https://www.okx.com",F={SWAP:"web3/dex-widget",BRIDGE:"web3/dex-widget/bridge"},M={[N.EVM]:"metamask",[N.SOLANA]:"phantom",[N.WALLET_CONNECT]:"walletconnect"},ue=501,re=e=>e?{inputChain:e.fromChain,outputChain:e.toChain,inputCurrency:e.fromToken,outputCurrency:e.toToken}:null;function je(e,t,r){const n=re(t),s=re(r);if(e===C.SWAP)return{supportTradeType:[C.SWAP],route:F.SWAP,defaultTokenPair:n,formattedTokenPair:n,formattedBridgeTokenPair:null};if(e===C.BRIDGE)return{supportTradeType:[C.BRIDGE],route:F.BRIDGE,defaultTokenPair:s,formattedTokenPair:null,formattedBridgeTokenPair:s};const o=!n&&s,a=o?F.BRIDGE:F.SWAP,d=o?s:n;return{supportTradeType:[C.SWAP,C.BRIDGE],route:a,defaultTokenPair:d,formattedTokenPair:n,formattedBridgeTokenPair:s}}const ne=e=>{const{baseUrl:t,feeConfig:r,tokenPair:n,bridgeTokenPair:s,providerType:o,tradeType:a,theme:d,lang:l,chainIds:u,extraParams:O}=e,w=pe.WIDGET_VERSION,E=pe.SDK_VERSION;Be({widgetVersion:w,feeConfig:r,tokenPair:n,bridgeTokenPair:s,providerType:o});const{supportTradeType:i,route:c,defaultTokenPair:_,formattedTokenPair:h,formattedBridgeTokenPair:p}=je(a,n,s),A={tradeType:i,theme:d,lang:l,walletType:M[o],widgetVersion:w,sdkVersion:E,chainIds:u},f={...A,..._},g=new URLSearchParams;for(const W in f)if(f.hasOwnProperty(W)){const B=f[W];B!==""&&B!==null&&B!==void 0&&g.append(W,B)}const P=g.toString(),R=`${typeof t=="string"?t:Nr}/${c}?${P}`,S={...A,tokenPair:h,bridgeTokenPair:p,feeConfig:r,providerType:o,extraParams:O};return{url:R,data:S}},Ir=async e=>{try{const t=await e.request({method:"eth_chainId"}),r=parseInt(t,16);return console.log(`log-requestChainId => decimal number: ${r}`),r}catch(t){return console.error("log-requestChainId => Failed to get chainId:",t),null}},wr=async e=>{try{const t=await e.request({method:"eth_accounts"});return console.log(`log-requestAddress: ${t.join(",")}`),t[0]}catch(t){return console.log("log-requestAddress-Failed to get account:",t),null}},le=e=>e===N.EVM,Fe=async(e,t)=>{console.log("log-getChainId-start",e,t);let r=null;return t===N.EVM&&(e!=null&&e.chainId)&&(r=parseInt(e.chainId,16)),t===N.WALLET_CONNECT&&(e!=null&&e.chainId)&&(r=e.chainId),t===N.SOLANA&&(r=ue),r===null&&e&&le(t)&&(r=await Ir(e)),console.log("log-getChainId-end",r),r},Ue=async(e,t)=>{var n,s;console.log("log-getAddress-start",e,t);let r=null;return t===N.EVM&&(e!=null&&e.chainId)&&(r=e.selectedAddress),t===N.WALLET_CONNECT&&(e!=null&&e.chainId)&&(r=(n=e.accounts)==null?void 0:n[0]),!r&&e&&le(t)&&(r=await wr(e)),t===N.SOLANA&&(r=(s=e==null?void 0:e.publicKey)==null?void 0:s.toBase58()),console.log("log-getAddress-end",r),r},K=e=>/^[\x20-\x7E]*$/.test(e),$e=e=>{try{const t=decodeURIComponent(e);if(!K(t))throw new Error(`Decoded value contains invalid characters: ${t}`);return t}catch(t){throw new Error(`Failed to decode URI component: ${e}. Error: ${t.message}`)}},Ge=e=>{const t=new URL(e),r=new URLSearchParams(t.search),n={};for(const[s,o]of r.entries()){const a=$e(o);n[s]=a}return n},k=e=>{if(console.log("params:",e),Ar(e)){if(!K(e))throw new Error(`Invalid string found: ${e}`);return!0}return De(e)&&pr(e,(t,r)=>{if(!K(r))throw new Error(`Invalid object key found: ${r}`);k(t)}),!0},L={INVALID_FEE_CONFIG:"FeeConfig MUST be an object",INVALID_FEE_PERCENT:"FeePercent MUST be a number > 0 and <= 3",INVALID_TOKEN_PAIR:"Invalid tokenPair",INVALID_BRIDGE_TOKEN_PAIR:"Invalid bridgeTokenPair",INVALID_PROVIDER_TYPE:"Invalid providerType",INVALID_WIDGET_VERSION:"WIDGET_VERSION IS REQUIRED"},q=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),Ee=e=>!Number.isNaN(Number(e))&&e!==null&&e!==void 0&&e!==""&&!Array.isArray(e),H=e=>Ee(e)&&Number(e)>0&&Number(e)<=3,Me=e=>q(e)?Object.values(e).some(r=>{const n=r==null?void 0:r.feePercent;return q(r==null?void 0:r.referrerAddress)?q(r==null?void 0:r.referrerAddress)?!!Object.values(r==null?void 0:r.referrerAddress).some(o=>Ee(o.feePercent)?!H(o==null?void 0:o.feePercent):!H(n)):!1:!H(n)})?L.INVALID_FEE_PERCENT:null:L.INVALID_FEE_CONFIG,G=e=>(typeof e=="string"||typeof e=="number")&&Number(e)>=0,yr=e=>{const t=G(e==null?void 0:e.fromChain)&&G(e==null?void 0:e.toChain);return Number(e==null?void 0:e.fromChain)===Number(e==null?void 0:e.toChain)&&t},oe=e=>G(e==null?void 0:e.fromChain)&&G(e==null?void 0:e.toChain),Be=({widgetVersion:e,feeConfig:t={},tokenPair:r,bridgeTokenPair:n,providerType:s})=>{const o=M[s];if(!e)throw new Error(L.INVALID_WIDGET_VERSION);if(s&&!o)throw new Error(L.INVALID_PROVIDER_TYPE);if(r&&!oe(r))throw new Error(L.INVALID_TOKEN_PAIR);if(n&&!oe(n))throw new Error(L.INVALID_BRIDGE_TOKEN_PAIR);const a=Me(t);if(a)throw new Error(a);return!0};function qe(e){const t={...e};return(e.gas||e.gasLimit)&&(t.gas=J.toNumber(e.gas??e.gasLimit)),(e.maxPriorityFeePerGas||e.maxFeePerGas)&&delete t.gasPrice,["gasPrice","gas","value","maxPriorityFeePerGas","maxFeePerGas","nonce","chainId"].filter(r=>!J.isNullish(t[r])).forEach(r=>{t[r]=J.numberToHex(t[r])}),t}class br{constructor(t){b(this,"iframeWindow");this.iframeWindow=t}async processTransaction(t,r,n,s,o,a){var l,u;const d={method:t,id:Number(r),params:s};try{if((o==null?void 0:o.selectedAddress)||((l=o==null?void 0:o.accounts)==null?void 0:l[0])||await o.request({method:"eth_requestAccounts",id:Date.now(),params:[]}),t==="eth_sendTransaction"){const w=qe(s[0]),E={method:t,id:Number(r),params:[w]};console.log("eth_sendTransaction requestPara.params[0]",{requestPara:d,requestPayload:E});const i=await((u=o==null?void 0:o.request)==null?void 0:u.call(o,E));console.log("provider.request===>",i),y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",data:i,path:n,type:a,error:null,success:!0})}else{const w=await o.request(d);console.log("sent evm transaction request:",w),y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",data:w,path:n,type:a,success:!0})}}catch(O){console.error("EVM Error:",O),y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",error:O&&JSON.stringify(O),path:n,type:a,success:!1})}}onProviderEvent(t,r){y(this.iframeWindow,I.PROVIDER_ONEVENT_WALLET_SATUS,{event:t,params:r})}registerProviderEventListeners(t){["connect","disconnect","close","chainChanged","accountsChanged"].forEach(n=>{t.on(n,s=>{this.onProviderEvent(n,s)})})}}function Pr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Rr(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=n}var a=e.length,d=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function O(i){if(i instanceof Uint8Array||(ArrayBuffer.isView(i)?i=new Uint8Array(i.buffer,i.byteOffset,i.byteLength):Array.isArray(i)&&(i=Uint8Array.from(i))),!(i instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(i.length===0)return"";for(var c=0,_=0,h=0,p=i.length;h!==p&&i[h]===0;)h++,c++;for(var A=(p-h)*u+1>>>0,f=new Uint8Array(A);h!==p;){for(var g=i[h],P=0,m=A-1;(g!==0||P<_)&&m!==-1;m--,P++)g+=256*f[m]>>>0,f[m]=g%a>>>0,g=g/a>>>0;if(g!==0)throw new Error("Non-zero carry");_=P,h++}for(var R=A-_;R!==A&&f[R]===0;)R++;for(var S=d.repeat(c);R<A;++R)S+=e.charAt(f[R]);return S}function w(i){if(typeof i!="string")throw new TypeError("Expected String");if(i.length===0)return new Uint8Array;for(var c=0,_=0,h=0;i[c]===d;)_++,c++;for(var p=(i.length-c)*l+1>>>0,A=new Uint8Array(p);i[c];){var f=t[i.charCodeAt(c)];if(f===255)return;for(var g=0,P=p-1;(f!==0||g<h)&&P!==-1;P--,g++)f+=a*A[P]>>>0,A[P]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");h=g,c++}for(var m=p-h;m!==p&&A[m]===0;)m++;for(var R=new Uint8Array(_+(p-m)),S=_;m!==p;)R[S++]=A[m++];return R}function E(i){var c=w(i);if(c)return c;throw new Error("Non-base"+a+" character")}return{encode:O,decodeUnsafe:w,decode:E}}var Sr=Rr;const Cr=Sr,Dr="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var Lr=Cr(Dr);const D=Pr(Lr),Vr=e=>{try{return U.Transaction.from(D.decode(e))}catch{const r=U.VersionedTransaction.deserialize(D.decode(e));return console.log("new version deserializeTransaction:",r),r}};class Oe{constructor(t){b(this,"iframeWindow");this.iframeWindow=t}async processTransaction(t,r,n,s,o,a){var d,l,u,O,w;try{const E=Array.isArray(s)?s:[s],i=E[0],c=(d=E[0])==null?void 0:d.onlyIfTrusted,_=(l=E[0])==null?void 0:l.okxArgs,h=(u=E[0])==null?void 0:u.transaction,p=(O=E[0])==null?void 0:O.type;if(t==="signAllTransactions"){const f=E.map(Vr);console.log("solana signAllTransactions newParams:",f);const g=await o[t](f),P=g.map(m=>{const R=(m==null?void 0:m.signature)||(m==null?void 0:m.signatures[0]),S=D.encode(R),W=D.encode(m.serialize());return{signature:S,serializedTransaction:W}});console.log("solana signAllTransactions request:",g,P),y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",data:P,path:n,type:a,success:!0});return}if(c){y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",data:{onlyIfTrusted:!0},path:n,type:a,success:!0});return}if(typeof i=="string")try{const f=U.Transaction.from(D.decode(i));E[0]=f}catch{const g=U.VersionedTransaction.deserialize(D.decode(i));console.log("new version deserializeTransaction:",g),E[0]=g}if(_&&p&&h){const f=U.VersionedTransaction.deserialize(D.decode(h)),g=(w=E[0])==null?void 0:w.options;E[0]=f,E[1]=g,E[2]=_}const A=await o[t](...E);console.log("solana request:",A),y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",data:A,path:n,type:a,success:!0})}catch(E){console.error("Solana Error:",E),y(this.iframeWindow,I.PROVIDER_ON_EVENT,{id:r,mode:"iframe",error:JSON.stringify(E),path:n,type:a,success:!1})}}onProviderEvent(t,r){const n=r==null?void 0:r.toBase58();y(this.iframeWindow,I.PROVIDER_ONEVENT_WALLET_SOLANA_SATUS,{event:t,params:{address:n,chainId:ue,walletType:M.SOLANA}})}registerProviderEventListeners(t){["connect","disconnect","accountChanged"].forEach(n=>{t.on(n,s=>{this.onProviderEvent(n,s)})})}async processConnectEvent(t,r){const{id:n,mode:s,params:o,path:a,type:d}=t||{params:null,mode:null,id:null,path:null,type:null};try{if(!r||s==="iframe")throw new Error("No Provider");const{method:l}=o[0]||{method:null};if(d==="solana"&&l==="connect"){const u=r;if(!(u!=null&&u.connect))throw new Error("Not solana provider");u.connect().then(O=>{y(this.iframeWindow,I.PROVIDER_ON_EVENT_CONNECT,{id:n,mode:"iframe",data:O.publicKey.toBase58(),path:a,type:d,success:!0})}).catch(O=>{y(this.iframeWindow,I.PROVIDER_ON_EVENT_CONNECT,{id:n,mode:"iframe",error:JSON.stringify(O),path:a,type:d,success:!1})})}}catch(l){y(this.iframeWindow,I.PROVIDER_ON_EVENT_CONNECT,{id:n,mode:"iframe",error:JSON.stringify(l),path:a,type:d,success:!1})}}}class vr{constructor(t,r){b(this,"strategy");switch(t){case N.SOLANA:this.strategy=new Oe(r);break;case N.WALLET_CONNECT:case N.EVM:this.strategy=new br(r);break;default:throw new Error("Unsupported provider type or network error",t)}}setStrategy(t){this.strategy=t}async processTransaction(t,r,n,s,o,a){console.log("processTransaction:",{method:t,id:r,path:n,requestArgs:s,provider:o,type:a}),await this.strategy.processTransaction(t,r,n,s,o,a)}registerProviderEventListeners(t){this.strategy.registerProviderEventListeners(t)}async processConnectEvent(t,r){this.strategy instanceof Oe&&(console.log("processConnectEvent:",this.strategy,{provider:r}),await this.strategy.processConnectEvent(t,r))}}class xr{constructor(t,r){b(this,"provider",null);b(this,"processor");b(this,"listener");b(this,"connectListener");b(this,"processProviderEventFromWindow",async t=>{console.log("processProviderEventFromWindow:",t);const{type:r}=t,{method:n,params:s}=t.params[0];await this.processor.processTransaction(n,t.id,t.path,s,this.provider,r)});b(this,"processConnectEvent",async t=>{await this.processor.processConnectEvent(t,this.provider)});this.iframeWindow=t,this.processor=new vr(r,this.iframeWindow)}disconnect(){this.provider=null,te(window,v.PROVIDER_ON_EVENT,this.listener),te(window,v.PROVIDER_ON_EVENT_CONNECT,this.connectListener)}onConnect(t){this.provider?this.disconnect():(console.log("onConnect====>"),this.listener=V(window,v.PROVIDER_ON_EVENT,this.processProviderEventFromWindow),this.connectListener=V(window,v.PROVIDER_ON_EVENT_CONNECT,this.processConnectEvent)),this.provider=t,this.processor.registerProviderEventListeners(t)}}const se="480px",He=450,Ae=375;function ze(e,t){Wr(e,t.width)}const fe=function(){const e=Date.now().toString();return function(){return{id:e,defaultClassName:`default-widget-iframe-${e}`,specifiedClassName:`specified-widget-iframe-${e}`}}}();function Ne(e,{defaultClassName:t,specifiedClassName:r,width:n}){e.innerHTML="",e.innerHTML=`
        .${t} {
            width: ${He}px;
            min-height: ${se};
            border: none;
        }
        @media (max-width: 767px) {
            .${t} {
                width: 100%;
            }
        }
        .${r} {
            width: ${n}px;
            min-height: ${se};
            border: none;
        }
    `}function Ie(e){const{id:t,defaultClassName:r,specifiedClassName:n}=fe(),s=document.getElementById(t);if(s)return Ne(s,{defaultClassName:r,specifiedClassName:n,width:e}),s;const o=document.createElement("style");return Ne(o,{defaultClassName:r,specifiedClassName:n,width:e}),o.id=t,document.head.appendChild(o),o}function Wr(e,t){const r=Number(t),{defaultClassName:n,specifiedClassName:s}=fe();r?(Ie(r<Ae?Ae:r),e.className=s):(Ie(He),e.className=n)}function jr(){const{id:e}=fe(),t=document.getElementById(e);t&&t.parentNode.removeChild(t)}const Z=async(e,t)=>({providerType:t,walletType:M[t],chainId:await Fe(e,t),address:await Ue(e,t)});function Fr(e,t){console.log("createOkxSwapWidget====>",e,t);const{params:r,provider:n,listeners:s}=t;let o=n,{data:a,url:d}=ne(r);const l=Ur(r,d);e.innerHTML="",e.appendChild(l);const{contentWindow:u}=l;if(!u)throw console.error("Iframe does not contain a window",l),new Error("Iframe does not contain a window!");const O=[],w=async()=>{const c=await Z(o,a.providerType);console.log("updateProviderEmitEvent====>dex-ready",c,o),ee(u,c,o)};O.push(...$r(l,r.height),Gr(u,a,w));const E=new Qe(window,s);let i=we(u,null,o,r.providerType);return l.addEventListener("load",()=>{console.log("updateParams====>load",o,a),ae(u,a),Z(o,a.providerType).then(c=>{console.log("updateProviderEmitEvent====>load-success",c,o),ee(u,c,o)}).catch(c=>{console.log("updateProviderEmitEvent====>load-error",o,c)})}),{updateParams:c=>{const{width:_,lang:h,theme:p,extraParams:A}=c;ze(l,{width:_});const f={...r,lang:h,theme:p,extraParams:A};a=ne(f).data,k(a),console.log("updateParams====>updateParamsFunction",o,r),ae(u,a)},updateListeners:c=>E.updateListeners(c),updateProvider:async(c,_)=>{var p;k(_),i==null||i.disconnect(),(p=o==null?void 0:o.removeAllListeners)==null||p.call(o),o=c;const h=await Z(o,_);a={...a,...h},i=we(u,i,c,_),console.log("updateProvider====>updateProviderFunction",c,_),ee(u,h,o)},destroy:()=>{i==null||i.disconnect(),E.stopListeningIframe(),O.forEach(c=>window.removeEventListener("message",c));try{e.removeChild(l)}catch(c){console.error("Error removing iframe, maybe iframe is removed",c)}jr()},iframeWindow:u}}function we(e,t,r,n){if(!r)return;if(!Object.values(N).includes(n))throw new Error("providerType is required");console.log("updateProvider iframeRpcProviderBridge===>",t),t&&t.disconnect();const o=new xr(e,n);return r&&o.onConnect(r),o}function Ur(e,t){const{width:r}=e,n=document.createElement("iframe");return Ge(t),n.src=t,ze(n,{width:r}),n.scrolling="no",n.style.border="none",n}function ee(e,t,r){const n=!!r;console.trace("updateProviderEmitEvent",t,r),y(e,I.UPDATE_PROVIDER,{appParams:t,hasProvider:n})}function ae(e,t){console.log("updateParams====>end",t,e),y(e,I.UPDATE_PARAMS,{appParams:t})}function $r(e,t=se){return[V(window,x.UPDATE_HEIGHT,r=>{e.style.height=r.height?`${r.height}px`:t,e.style.minHeight=r.height?`${r.height}px`:t}),V(window,x.SET_FULL_HEIGHT,({isUpToSmall:r})=>{e.style.height=r?t:`${document.body.offsetHeight}px`,e.style.minHeight=r?t:`${document.body.offsetHeight}px`})]}function Gr(e,t,r){const n=V(window,x.LOAD_READY,()=>{console.log("updateParams=====>dex-ready",e,t),ae(e,t),r(),ie(window,n)});return n}exports.ChainName=Je;exports.ERROR_MSG=L;exports.ProviderType=N;exports.SOLANA_CHAIN_ID=ue;exports.SimpleOkxEventEmitter=ye;exports.THEME=Pe;exports.TradeType=C;exports.WALLET_TYPE=M;exports.WIDGET_PALETTE_COLORS=Xe;exports.WIDGET_ROUTE_CONSTANTS=F;exports.WidgetMethodsEmit=x;exports.WidgetMethodsListen=I;exports.WidgetProviderEvents=v;exports.checkFeeConfig=Me;exports.checkTokenPairChain=oe;exports.checkUrlParam=Ge;exports.createOkxSwapWidget=Fr;exports.createWidgetParams=ne;exports.formatDefaultConfig=je;exports.formatTokenPair=re;exports.getAddress=Ue;exports.getChainId=Fe;exports.isEvmProvider=le;exports.isNumberOrNumberString=Ee;exports.isObject=q;exports.isPrintableString=K;exports.isSameChain=yr;exports.listenToMessageFromWindow=V;exports.postMessageToWindow=y;exports.safeDecodeURIComponent=$e;exports.stopListeningToMessageFromWindow=te;exports.stopListeningWindowListener=ie;exports.txInputParamsFormatter=qe;exports.validateWidgetParams=k;exports.verifyChainId=G;exports.verifyPercent=H;exports.verifyWidgetParams=Be;
//# sourceMappingURL=OkxSwapWidget.kxfAW3oz.mjs.map
